generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:../db/baby-control.db"
}

enum Gender {
  MALE
  FEMALE
}

enum SleepType {
  NAP
  NIGHT_SLEEP
}

enum SleepQuality {
  POOR
  FAIR
  GOOD
  EXCELLENT
}

enum FeedType {
  BREAST
  BOTTLE
  SOLIDS
}

enum BreastSide {
  LEFT
  RIGHT
}

enum DiaperType {
  WET
  DIRTY
  BOTH
}

enum Mood {
  HAPPY
  CALM
  FUSSY
  CRYING
}

enum UserRole {
  USER
  ADMIN
}

enum MilestoneCategory {
  MOTOR
  COGNITIVE
  SOCIAL
  LANGUAGE
  CUSTOM
}

enum PlayType {
  TUMMY_TIME
  INDOOR_PLAY
  OUTDOOR_PLAY
  CUSTOM
}

enum MeasurementType {
  HEIGHT
  WEIGHT
  HEAD_CIRCUMFERENCE
  TEMPERATURE
}

enum CalendarEventType {
  APPOINTMENT
  CARETAKER_SCHEDULE
  REMINDER
  CUSTOM
}

enum RecurrencePattern {
  DAILY
  WEEKLY
  BIWEEKLY
  MONTHLY
  YEARLY
  CUSTOM
}

model Account {
  id            String   @id @default(cuid())
  email         String   @unique
  password      String   // bcrypt hashed
  firstName     String?
  lastName      String?
  verified      Boolean  @default(false)
  verificationToken String? @unique
  passwordResetToken String? @unique
  passwordResetExpires DateTime?
  betaparticipant Boolean @default(false) 
  closed        Boolean  @default(false) 
  closedAt      DateTime? 
  
  provider      String?  
  providerId    String? 
  stripeCustomerId String?
  subscriptionId   String?
  planType         String? 
  planExpires      DateTime?
  trialEnds        DateTime?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  family        Family?  @relation(fields: [familyId], references: [id])
  familyId      String?  @unique
  
  caretaker     Caretaker? @relation(fields: [caretakerId], references: [id])
  caretakerId   String?    @unique
  

  feedback      Feedback[]
  
  @@index([email])
  @@index([verified])
  @@index([verificationToken])
  @@index([passwordResetToken])
}

model Family {
  id        String   @id @default(cuid())
  slug      String   @unique
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  isActive  Boolean  @default(true)
  
  account       Account?
  accountId     String?  @unique
  
  babies           Baby[]
  caretakers       Caretaker[]
  settings         Settings[]
  sleepLogs        SleepLog[]
  feedLogs         FeedLog[]
  diaperLogs       DiaperLog[]
  moodLogs         MoodLog[]
  notes            Note[]
  milestones       Milestone[]
  pumpLogs         PumpLog[]
  playLogs         PlayLog[]
  bathLogs         BathLog[]
  measurements     Measurement[]
  medicines        Medicine[]
  medicineLogs     MedicineLog[]
  contacts         Contact[]
  calendarEvents   CalendarEvent[]
  familyMembers    FamilyMember[]
  familySetups     FamilySetup[]
  feedback         Feedback[]
}

model FamilyMember {
  family       Family    @relation(fields: [familyId], references: [id])
  familyId     String
  caretaker    Caretaker @relation(fields: [caretakerId], references: [id])
  caretakerId  String
  role         String   
  joinedAt     DateTime  @default(now())
  
  @@id([familyId, caretakerId])
  @@index([familyId])
  @@index([caretakerId])
}

model Baby {
  id               String        @id @default(uuid())
  firstName        String
  lastName         String
  birthDate        DateTime
  gender           Gender?
  inactive         Boolean       @default(false)
  feedWarningTime  String        @default("03:00") 
  diaperWarningTime String       @default("02:00") 
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  deletedAt        DateTime?
  
  family           Family?       @relation(fields: [familyId], references: [id])
  familyId         String?     
  
  sleepLogs        SleepLog[]
  feedLogs         FeedLog[]
  diaperLogs       DiaperLog[]
  moodLogs         MoodLog[]
  notes            Note[]
  milestones       Milestone[]
  pumpLogs         PumpLog[]
  playLogs         PlayLog[]
  bathLogs         BathLog[]
  measurements     Measurement[]
  events           BabyEvent[]  
  medicineLogs     MedicineLog[] 
  
  @@index([birthDate])
  @@index([deletedAt])
  @@index([familyId])
}

model Caretaker {
  id           String    @id @default(uuid())
  loginId      String   
  name         String
  type         String?  
  role         UserRole  @default(USER) 
  inactive     Boolean   @default(false)
  securityPin  String
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  deletedAt    DateTime?
  
  family       Family?   @relation(fields: [familyId], references: [id])
  familyId     String?  
  
  account       Account?
  accountId     String?  @unique
  
  sleepLogs    SleepLog[]
  feedLogs     FeedLog[]
  diaperLogs   DiaperLog[]
  moodLogs     MoodLog[]
  notes        Note[]
  milestones   Milestone[]
  pumpLogs     PumpLog[]
  playLogs     PlayLog[]
  bathLogs     BathLog[]
  measurements Measurement[]
  medicineLogs MedicineLog[]
  events       CaretakerEvent[]
  familyMembers FamilyMember[]
  familySetups  FamilySetup[]
  feedback     Feedback[]
  
  @@index([deletedAt])
  @@index([familyId])
  @@index([accountId])
}

model SleepLog {
  id          String       @id @default(uuid())
  startTime   DateTime
  endTime     DateTime?
  duration    Int? 
  type        SleepType
  location    String?
  quality     SleepQuality?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  deletedAt   DateTime?
  
  family      Family?      @relation(fields: [familyId], references: [id])
  familyId    String?   
  
  baby        Baby         @relation(fields: [babyId], references: [id], onDelete: Cascade)
  babyId      String
  caretaker   Caretaker?   @relation(fields: [caretakerId], references: [id])
  caretakerId String?
  
  @@index([startTime])
  @@index([endTime])
  @@index([babyId])
  @@index([caretakerId])
  @@index([deletedAt])
  @@index([familyId])
}

model Unit {
  id          String        @id @default(uuid())
  unitAbbr    String        @unique
  unitName    String
  activityTypes String?    
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  


  feedLogs    FeedLog[]
  pumpLogs    PumpLog[]
  medicines   Medicine[]   
  medicineLogs MedicineLog[] 
  
  @@index([unitAbbr])
}

model FeedLog {
  id           String      @id @default(uuid())
  time         DateTime
  startTime    DateTime?   
  endTime      DateTime?   
  feedDuration Int?        
  type         FeedType
  amount       Float?     
  unit         Unit?       @relation(fields: [unitAbbr], references: [unitAbbr])
  unitAbbr     String?
  side         BreastSide?
  food         String?    
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  deletedAt    DateTime?
  
  family       Family?     @relation(fields: [familyId], references: [id])
  familyId     String?     
  
  baby         Baby        @relation(fields: [babyId], references: [id], onDelete: Cascade)
  babyId       String
  caretaker    Caretaker?  @relation(fields: [caretakerId], references: [id])
  caretakerId  String?
  
  @@index([time])
  @@index([startTime])
  @@index([endTime])
  @@index([babyId])
  @@index([caretakerId])
  @@index([unitAbbr])
  @@index([deletedAt])
  @@index([familyId])
}

model DiaperLog {
  id          String     @id @default(uuid())
  time        DateTime
  type        DiaperType
  condition   String?
  color       String?
  blowout     Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  deletedAt   DateTime?
  
  family      Family?    @relation(fields: [familyId], references: [id])
  familyId    String?   
  
  baby        Baby       @relation(fields: [babyId], references: [id], onDelete: Cascade)
  babyId      String
  caretaker   Caretaker? @relation(fields: [caretakerId], references: [id])
  caretakerId String?
  
  @@index([time])
  @@index([babyId])
  @@index([caretakerId])
  @@index([deletedAt])
  @@index([familyId])
}

model MoodLog {
  id          String    @id @default(uuid())
  time        DateTime
  mood        Mood
  intensity   Int?      @default(3) 
  duration    Int?    
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt   DateTime?
  
  family      Family?   @relation(fields: [familyId], references: [id])
  familyId    String?   
  
  baby        Baby      @relation(fields: [babyId], references: [id], onDelete: Cascade)
  babyId      String
  caretaker   Caretaker? @relation(fields: [caretakerId], references: [id])
  caretakerId String?
  
  @@index([time])
  @@index([babyId])
  @@index([caretakerId])
  @@index([deletedAt])
  @@index([familyId])
}

model Note {
  id          String    @id @default(uuid())
  time        DateTime
  content     String    
  category    String?  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt   DateTime?
  
  family      Family?   @relation(fields: [familyId], references: [id])
  familyId    String?   
  
  baby        Baby      @relation(fields: [babyId], references: [id], onDelete: Cascade)
  babyId      String
  caretaker   Caretaker? @relation(fields: [caretakerId], references: [id])
  caretakerId String?
  
  @@index([time])
  @@index([babyId])
  @@index([caretakerId])
  @@index([deletedAt])
  @@index([familyId])
}

model Settings {
  id                String   @id @default(uuid())
  familyName        String   @default("My Family")
  securityPin       String   @default("111222")
  authType          String?  
  defaultBottleUnit String   @default("OZ")   
  defaultSolidsUnit String   @default("TBSP")  
  defaultHeightUnit String   @default("IN")    
  defaultWeightUnit String   @default("LB")   
  defaultTempUnit   String   @default("F")   
  activitySettings  String?
  enableDebugTimer  Boolean  @default(false) 
  enableDebugTimezone Boolean @default(false)  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  family            Family?  @relation(fields: [familyId], references: [id])
  familyId          String?  
  
  @@index([familyId])
}


model Milestone {
  id          String           @id @default(uuid())
  date        DateTime
  title       String
  description String?
  category    MilestoneCategory
  ageInDays   Int?             
  photo       String?          
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  deletedAt   DateTime?
  
  family      Family?          @relation(fields: [familyId], references: [id])
  familyId    String?         
  baby        Baby             @relation(fields: [babyId], references: [id], onDelete: Cascade)
  babyId      String
  caretaker   Caretaker?       @relation(fields: [caretakerId], references: [id])
  caretakerId String?
  
  @@index([date])
  @@index([babyId])
  @@index([caretakerId])
  @@index([deletedAt])
  @@index([familyId])
}

model PumpLog {
  id             String         @id @default(uuid())
  startTime      DateTime
  endTime        DateTime?
  duration       Int?           
  leftAmount     Float?        
  rightAmount    Float?        
  totalAmount    Float?        
  unit           Unit?          @relation(fields: [unitAbbr], references: [unitAbbr])
  unitAbbr       String?
  notes          String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  deletedAt      DateTime?
  
  family         Family?        @relation(fields: [familyId], references: [id])
  familyId       String?        
  
  baby           Baby           @relation(fields: [babyId], references: [id], onDelete: Cascade)
  babyId         String
  caretaker      Caretaker?     @relation(fields: [caretakerId], references: [id])
  caretakerId    String?
  
  @@index([startTime])
  @@index([endTime])
  @@index([babyId])
  @@index([caretakerId])
  @@index([unitAbbr])
  @@index([deletedAt])
  @@index([familyId])
}

model PlayLog {
  id          String    @id @default(uuid())
  startTime   DateTime
  endTime     DateTime?
  duration    Int?      
  type        PlayType
  location    String?
  activities  String?   
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt   DateTime?
  
  family      Family?   @relation(fields: [familyId], references: [id])
  familyId    String?   
  
  baby        Baby      @relation(fields: [babyId], references: [id], onDelete: Cascade)
  babyId      String
  caretaker   Caretaker? @relation(fields: [caretakerId], references: [id])
  caretakerId String?
  
  @@index([startTime])
  @@index([endTime])
  @@index([babyId])
  @@index([caretakerId])
  @@index([deletedAt])
  @@index([familyId])
}

model BathLog {
  id              String           @id @default(uuid())
  time            DateTime         
  soapUsed        Boolean          @default(true)
  shampooUsed     Boolean          @default(true)
  notes           String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  deletedAt       DateTime?
  
 
  family          Family?          @relation(fields: [familyId], references: [id])
  familyId        String?         
  baby            Baby             @relation(fields: [babyId], references: [id], onDelete: Cascade)
  babyId          String
  caretaker       Caretaker?       @relation(fields: [caretakerId], references: [id])
  caretakerId     String?
  
  @@index([time])
  @@index([babyId])
  @@index([caretakerId])
  @@index([deletedAt])
  @@index([familyId])
}

model Measurement {
  id          String           @id @default(uuid())
  date        DateTime
  type        MeasurementType
  value       Float
  unit        String          
  notes       String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  deletedAt   DateTime?
  
  family      Family?          @relation(fields: [familyId], references: [id])
  familyId    String?          
  
  baby        Baby             @relation(fields: [babyId], references: [id], onDelete: Cascade)
  babyId      String
  caretaker   Caretaker?       @relation(fields: [caretakerId], references: [id])
  caretakerId String?
  
  @@index([date])
  @@index([type])
  @@index([babyId])
  @@index([caretakerId])
  @@index([deletedAt])
  @@index([familyId])
}

model Contact {
  id          String    @id @default(uuid())
  name        String
  role        String   
  phone       String?
  email       String?
  address     String?
  notes       String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt   DateTime?
  
  family      Family?   @relation(fields: [familyId], references: [id])
  familyId    String?  
  
  events      ContactEvent[] 
  medicines   ContactMedicine[] 
  
  @@index([role])
  @@index([deletedAt])
  @@index([familyId])
}

model CalendarEvent {
  id                String           @id @default(uuid())
  title             String
  description       String?
  startTime         DateTime
  endTime           DateTime?
  allDay            Boolean          @default(false)
  type              CalendarEventType
  location          String?
  color             String?         
  

  recurring         Boolean          @default(false)
  recurrencePattern RecurrencePattern? 
  recurrenceEnd     DateTime?        
  customRecurrence  String?          
  reminderTime      Int?           
  notificationSent  Boolean          @default(false)
  
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  deletedAt         DateTime?
  
  family            Family?          @relation(fields: [familyId], references: [id])
  familyId          String?        
  
  babies            BabyEvent[]
  caretakers        CaretakerEvent[]
  contacts          ContactEvent[]  
  
  @@index([startTime])
  @@index([endTime])
  @@index([type])
  @@index([recurring])
  @@index([deletedAt])
  @@index([familyId])
}

model BabyEvent {
  baby        Baby          @relation(fields: [babyId], references: [id], onDelete: Cascade)
  babyId      String
  event       CalendarEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)
  eventId     String
  
  @@id([babyId, eventId])
  @@index([babyId])
  @@index([eventId])
}

model CaretakerEvent {
  caretaker   Caretaker     @relation(fields: [caretakerId], references: [id], onDelete: Cascade)
  caretakerId String
  event       CalendarEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)
  eventId     String
  
  @@id([caretakerId, eventId])
  @@index([caretakerId])
  @@index([eventId])
}

model ContactEvent {
  contact     Contact       @relation(fields: [contactId], references: [id], onDelete: Cascade)
  contactId   String
  event       CalendarEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)
  eventId     String
  
  @@id([contactId, eventId])
  @@index([contactId])
  @@index([eventId])
}

model Medicine {
  id              String           @id @default(uuid())
  name            String
  typicalDoseSize Float?
  unitAbbr        String?
  doseMinTime     String?         
  notes           String?         
  active          Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  deletedAt       DateTime?
  
  family          Family?          @relation(fields: [familyId], references: [id])
  familyId        String?          
  
  medicineLogs    MedicineLog[]  
  contacts        ContactMedicine[] 
  unit            Unit?            @relation(fields: [unitAbbr], references: [unitAbbr])
  
  @@index([name])
  @@index([active])
  @@index([unitAbbr])
  @@index([deletedAt])
  @@index([familyId])
}

model MedicineLog {
  id              String           @id @default(uuid())
  time            DateTime
  doseAmount      Float
  unitAbbr        String?
  notes           String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  deletedAt       DateTime?
  
  family          Family?          @relation(fields: [familyId], references: [id])
  familyId        String?          
  
  medicine        Medicine         @relation(fields: [medicineId], references: [id], onDelete: Cascade)
  medicineId      String
  baby            Baby             @relation(fields: [babyId], references: [id], onDelete: Cascade)
  babyId          String
  caretaker       Caretaker?       @relation(fields: [caretakerId], references: [id])
  caretakerId     String?
  unit            Unit?            @relation(fields: [unitAbbr], references: [unitAbbr])
  
  @@index([time])
  @@index([medicineId])
  @@index([babyId])
  @@index([caretakerId])
  @@index([unitAbbr])
  @@index([deletedAt])
  @@index([familyId])
}

model ContactMedicine {
  contact         Contact          @relation(fields: [contactId], references: [id], onDelete: Cascade)
  contactId       String
  medicine        Medicine         @relation(fields: [medicineId], references: [id], onDelete: Cascade)
  medicineId      String
  
  @@id([contactId, medicineId])
  @@index([contactId])
  @@index([medicineId])
}

model FamilySetup {
  id        String   @id @default(cuid())
  token     String   @unique
  password  String  
  expiresAt DateTime
  createdBy String  
  familyId  String?  @unique 
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  creator   Caretaker @relation(fields: [createdBy], references: [id], onDelete: Cascade)
  family    Family?   @relation(fields: [familyId], references: [id], onDelete: Cascade)

  @@index([createdBy])
}

model BetaSubscriber {
  id          String   @id @default(cuid())
  email       String   @unique
  firstName   String?
  lastName    String?
  isOptedIn   Boolean  @default(true)
  optedOutAt  DateTime?
  source      String   @default("coming-soon")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  deletedAt   DateTime?
  
  campaignEmails BetaCampaignEmail[]
  
  @@index([email])
  @@index([isOptedIn])
  @@index([source])
  @@index([createdAt])
  @@index([deletedAt])
}

model BetaCampaign {
  id          String   @id @default(cuid())
  name        String
  subject     String
  content     String?
  type        BetaCampaignType @default(NOTIFICATION)
  isActive    Boolean  @default(true)
  scheduledAt DateTime?
  sentAt      DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  deletedAt   DateTime?
  
  campaignEmails BetaCampaignEmail[]
  
  @@index([type])
  @@index([isActive])
  @@index([scheduledAt])
  @@index([createdAt])
  @@index([deletedAt])
}

model BetaCampaignEmail {
  id            String   @id @default(cuid())
  sentAt        DateTime @default(now())
  deliveredAt   DateTime?
  openedAt      DateTime?
  clickedAt     DateTime?
  status        BetaEmailStatus @default(SENT)
  errorMessage  String?
  
  campaign      BetaCampaign     @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  campaignId    String
  subscriber    BetaSubscriber   @relation(fields: [subscriberId], references: [id], onDelete: Cascade)
  subscriberId  String
  
  @@unique([campaignId, subscriberId])
  @@index([sentAt])
  @@index([status])
  @@index([campaignId])
  @@index([subscriberId])
}

enum BetaCampaignType {
  NOTIFICATION
  UPDATE
  WELCOME
  REMINDER
}

enum BetaEmailStatus {
  SENT
  DELIVERED
  OPENED
  CLICKED
  BOUNCED
  FAILED
}

enum EmailProviderType {
  MANUAL_SFTP
  SENDGRID
  SMTP2GO
}

model AppConfig {
  id          String   @id @default(cuid())
  adminPass   String   
  rootDomain  String   
  enableHttps Boolean  @default(false) 
  updatedAt   DateTime @updatedAt
}

model EmailConfig {
  id                  String            @id @default(cuid())
  providerType        EmailProviderType @default(SENDGRID)
  sendGridApiKey      String?
  smtp2goApiKey       String?
  serverAddress       String?
  port                Int?
  username            String?
  password            String?
  enableTls           Boolean           @default(true)
  allowSelfSignedCert Boolean           @default(false)
  updatedAt           DateTime          @updatedAt
}

model DemoTracker {
  id                String   @id @default(cuid())
  familyId          String   @unique 
  sourceFamilyId    String   
  dateRangeStart    DateTime 
  dateRangeEnd      DateTime 
  generatedAt       DateTime @default(now())
  lastAccessedAt    DateTime?
  accessCount       Int      @default(0)
  notes             String? 
  
  @@index([generatedAt])
  @@index([lastAccessedAt])
}

model Feedback {
  id          String    @id @default(uuid())
  subject     String
  message     String
  submittedAt DateTime  @default(now())
  viewed      Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt   DateTime?
  
  family      Family?   @relation(fields: [familyId], references: [id])
  familyId    String?   
  
  account     Account?  @relation(fields: [accountId], references: [id])
  accountId   String?  
  
  caretaker   Caretaker? @relation(fields: [caretakerId], references: [id])
  caretakerId String? 
  
  submitterName  String? 
  submitterEmail String? 
  
  @@index([submittedAt])
  @@index([viewed])
  @@index([familyId])
  @@index([accountId])
  @@index([caretakerId])
  @@index([deletedAt])
}
